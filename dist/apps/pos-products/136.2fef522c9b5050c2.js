/*! For license information please see 136.2fef522c9b5050c2.js.LICENSE.txt */
(self.webpackChunkpos_products=self.webpackChunkpos_products||[]).push([[136],{136:(e,s,n)=>{n.r(s),n.d(s,{default:()=>I});var t=n(1921),r=n(9619),o=n(7786);let i="http://vendus-pt/ws/v1.2/products/";i="https://www.vendus.pt/ws/v1.2/products/";var a=n(3501),l=n(2322);const c=({placeholder:e,setQueryString:s,disabled:n,focusSearchBar:o})=>{const i=(0,r.useRef)(null);return(0,r.useEffect)((()=>{o&&setTimeout((()=>{var e;return null==(e=i.current)?void 0:e.setFocus()}),10)}),[o,n]),(0,l.jsx)(t.IonSearchbar,{mode:"ios",placeholder:e,debounce:1e3,onIonChange:e=>(e=>{let n="";const t=e.target;t&&(n=t.value.toLowerCase()),s(n)})(e),onIonClear:e=>s(""),disabled:n,ref:i,className:"search-bar ion-no-padding",inputmode:"search",enterkeyhint:"enter"})},d=({setQueryString:e})=>{const s=(0,a.useIsFetching)(),[n,o]=(0,r.useState)(!1);return(0,t.useIonViewWillLeave)((()=>{o(!1)})),(0,l.jsx)(t.IonHeader,{children:(0,l.jsxs)(t.IonToolbar,{children:[(0,l.jsxs)(t.IonButtons,{slot:"start",className:"header-buttons",children:[(0,l.jsx)(t.IonMenuButton,{}),(0,l.jsxs)(t.IonCol,{className:"title-spinner",children:[(0,l.jsx)(t.IonTitle,{className:"title ion-no-padding ion-padding-end",children:"Products"}),s?(0,l.jsx)(t.IonSpinner,{className:"spinner",name:"dots"}):null]})]}),(0,l.jsx)(c,{placeholder:"Busca...",setQueryString:s=>{e(s)},disabled:!!s,focusSearchBar:n})]})})};var u=n(6414),h=n.n(u);const x=()=>(0,l.jsxs)(h(),{speed:2,width:200,height:62,viewBox:"0 0 200 62",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,l.jsx)("rect",{x:"72",y:"16",rx:"3",ry:"3",width:"150",height:"15"}),(0,l.jsx)("rect",{x:"72",y:"38",rx:"3",ry:"3",width:"74",height:"13"}),(0,l.jsx)("rect",{x:"0",y:"15",rx:"3",ry:"3",width:"40",height:"33"})]}),j=({item:e,isFetching:s,isPreviousData:n})=>{const r=(0,a.useQueryClient)(),o=(0,a.useQuery)(["actualSale"],(()=>0),{staleTime:1/0});return(0,l.jsx)(l.Fragment,{children:s&&n?(0,l.jsx)(x,{}):(0,l.jsxs)(t.IonCol,{onClick:()=>(async e=>{r.setQueryData(["sales",o.data],(s=>{const n=s.find((s=>s.id===e.id));return n&&(n.qty=n.qty+1),n?[...s]:[...s,Object.assign({},e,{qty:1})]}))})(e),size:"1","size-md":"1",sizeLg:"1",sizeSm:"3",sizeXs:"3",className:"product-item",children:[(0,l.jsx)("span",{children:e.title}),(0,l.jsxs)("span",{className:"price-bold",children:["€ ",e.prices.gross]})]})})};var p=n(6021);const m=()=>{var e;const s=(0,a.useQuery)([["actualSale"]],(()=>0),{staleTime:1/0}),n=(0,a.useQuery)(["sales",s.data],(()=>[]),{staleTime:1/0}),r=(0,a.useQueryClient)();if(n.isError)return(0,l.jsx)("p",{children:"Something went wrong..."});const o=()=>{r.setQueryData(["actualSale"],(e=>e+1))};return(0,l.jsxs)(t.IonGrid,{children:[(0,l.jsxs)(t.IonRow,{className:"ion-justify-content-center",children:[(0,l.jsx)(t.IonCol,{className:"ion-justify-content-start flex",children:(0,l.jsx)(t.IonButton,{fill:"clear",onClick:()=>{r.setQueryData(["actualSale"],(e=>0===e?0:e-1))},children:(0,l.jsx)(t.IonIcon,{icon:p.arrowBack})})}),(0,l.jsxs)(t.IonCol,{className:"ion-justify-content-center flex ion-align-items-center",children:[(0,l.jsx)(t.IonText,{children:`Sale ${"number"==typeof s.data?s.data+1:null}`}),(0,l.jsx)(t.IonButton,{fill:"clear",onClick:()=>o(),children:(0,l.jsx)(t.IonIcon,{icon:p.addCircle})})]}),(0,l.jsx)(t.IonCol,{className:"ion-justify-content-end flex",children:(0,l.jsx)(t.IonButton,{fill:"clear",onClick:()=>o(),children:(0,l.jsx)(t.IonIcon,{icon:p.arrowForward})})})]}),(0,l.jsx)(t.IonRow,{children:(0,l.jsx)(t.IonList,{lines:"full",className:"full-width",children:(0,l.jsx)(l.Fragment,{children:null==(e=n.data)?void 0:e.map((e=>(0,l.jsxs)(t.IonItem,{children:[(0,l.jsx)(t.IonText,{slot:"start",children:e.qty}),(0,l.jsx)(t.IonLabel,{children:e.title}),(0,l.jsx)(t.IonButton,{slot:"end",fill:"clear",onClick:()=>{return n=e.id,void r.setQueryData(["sales",s.data],(e=>{const s=e.find((e=>e.id===n));return s.qty>=1&&(s.qty=s.qty-1),s.qty>=1?[...e]:e.filter((e=>e.id!==n))}));var n},children:(0,l.jsx)(t.IonIcon,{icon:p.close})})]},e.id)))})})})]})},I=({apiKey:e})=>{const s=(0,a.useQuery)(["products"],(()=>(async e=>{let s;const n={url:"https://www.vendus.pt/ws/v1.2/products/",params:{api_key:e,envelope:"1"}};return await o.CapacitorHttp.get(n).then((e=>s=e.data)).catch((e=>Promise.reject(new Error(e)))),s})(e)),{keepPreviousData:!0,staleTime:6e4}),[n,i]=(0,r.useState)("");return s.isError?(0,l.jsx)("p",{children:"Something went wrong..."}):(0,l.jsxs)(t.IonPage,{children:[(0,l.jsx)(d,{setQueryString:e=>{i(e)}}),(0,l.jsx)(t.IonContent,{fullscreen:!0,children:(0,l.jsx)(t.IonGrid,{className:"h--100",children:(0,l.jsxs)(t.IonRow,{className:"h--100",children:[(0,l.jsx)(t.IonCol,{size:"12","size-lg":"8",className:"side-menu",children:s.isSuccess?(0,l.jsx)("div",{children:s.data.response.length>0?(0,l.jsx)(t.IonGrid,{fixed:!0,className:"product-list",children:(0,l.jsx)(t.IonRow,{children:s.data.response.map((e=>(0,l.jsx)(j,{item:e,isFetching:s.isFetching,isPreviousData:s.isPreviousData},e.id)))})}):(0,l.jsx)(t.IonRow,{className:"ion-align-items-center ion-justify-content-center",children:(0,l.jsxs)(t.IonCol,{className:"ion-text-center ion-margin-top",size:"auto",children:[(0,l.jsx)(t.IonRow,{className:"ion-justify-content-center",children:(0,l.jsx)(t.IonCol,{size:"8",children:(0,l.jsx)(t.IonRow,{className:"ion-justify-content-center",children:(0,l.jsx)(t.IonImg,{className:"",src:"/assets/img/icon-empty.svg"})})})}),(0,l.jsx)(t.IonTitle,{className:"ion-margin-top ion-margin-bottom",children:"Não foi encontrado Dados."}),(0,l.jsx)(t.IonText,{class:"ion-margin-top",children:"Não existem dados disponíveis nesta busca. Ajuste o filtro, se necessário."})]})})}):null}),(0,l.jsx)(t.IonCol,{size:"12","size-sm":"4",children:(0,l.jsx)(m,{})})]})})}),(0,l.jsx)(t.IonFooter,{children:(0,l.jsx)(t.IonToolbar,{children:(0,l.jsx)(t.IonGrid,{children:(0,l.jsx)(t.IonRow,{children:(0,l.jsx)(t.IonCol,{size:"12",className:"ion-text-center",children:(0,l.jsx)("p",{children:"Footer"})})})})})})]})}},1837:(e,s,n)=>{var t=n(9619),r=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,s,n){var t,o={},c=null,d=null;for(t in void 0!==n&&(c=""+n),void 0!==s.key&&(c=""+s.key),void 0!==s.ref&&(d=s.ref),s)i.call(s,t)&&!l.hasOwnProperty(t)&&(o[t]=s[t]);if(e&&e.defaultProps)for(t in s=e.defaultProps)void 0===o[t]&&(o[t]=s[t]);return{$$typeof:r,type:e,key:c,ref:d,props:o,_owner:a.current}}s.Fragment=o,s.jsx=c,s.jsxs=c},2322:(e,s,n)=>{e.exports=n(1837)}}]);