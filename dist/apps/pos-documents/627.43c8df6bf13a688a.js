/*! For license information please see 627.43c8df6bf13a688a.js.LICENSE.txt */
(self.webpackChunkpos_documents=self.webpackChunkpos_documents||[]).push([[627,297],{9297:(e,n,t)=>{t.r(n),t.d(n,{default:()=>h,useDocumentDetailsOptions:()=>p});var s=t(1921),o=t(6021),a=t(9619),i=t(3501),d=t(1521),l=t(5785),r=t(5912),c=t(2322);const m=({apiKey:e})=>{const{id:n}=(0,d.useParams)(),[t,m]=(0,s.useIonLoading)(),h=(0,a.useRef)(),p=(0,i.useQuery)(["document",n],(()=>l.Nl(e,n)),{staleTime:6e4});if(p.isSuccess&&(h.current=p.data.type),p.isLoading)return(0,c.jsx)(c.Fragment,{});if(p.isError)return(0,c.jsx)(s.IonList,{children:(0,c.jsx)(s.IonItem,{children:(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)(s.IonText,{className:"ion-padding",children:"Something went wrong..."})})})});const x=e=>{t({message:e})};return(0,c.jsxs)(s.IonList,{lines:"full",className:"ion-no-padding",children:[r.Ry(h.current,"edit")?(0,c.jsxs)(s.IonItem,{className:"FS",button:!0,detail:!0,children:[(0,c.jsx)(s.IonIcon,{icon:o.create,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Editar"})})]}):null,r.Ry(h.current,"print")?(0,c.jsxs)(s.IonItem,{className:"FT",button:!0,detail:!0,onClick:()=>{x("A imprimir..."),setTimeout((()=>m()),3e3)},children:[(0,c.jsx)(s.IonIcon,{icon:o.printSharp,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Imprimir"})})]}):null,r.Ry(h.current,"sendEmail")?(0,c.jsxs)(s.IonItem,{className:"NH",button:!0,detail:!0,onClick:()=>{x("A Enviar Email..."),setTimeout((()=>m()),3e3)},children:[(0,c.jsx)(s.IonIcon,{icon:o.mailSharp,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Enviar por E-mail"})})]}):null,r.Ry(h.current,"cancel")?(0,c.jsxs)(s.IonItem,{className:"RG",button:!0,detail:!0,children:[(0,c.jsx)(s.IonIcon,{icon:o.close,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Anular"})})]}):null,r.Ry(h.current,"creditNote")?(0,c.jsxs)(s.IonItem,{className:"NC",button:!0,detail:!0,children:[(0,c.jsx)(s.IonIcon,{icon:o.documentTextSharp,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Nota de Crédito"})})]}):null,r.Ry(h.current,"createTransport")?(0,c.jsxs)(s.IonItem,{className:"FS",button:!0,detail:!0,children:[(0,c.jsx)(s.IonIcon,{icon:o.carSharp,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Criar Transporte"})})]}):null,r.Ry(h.current,"offerCoupon")?(0,c.jsxs)(s.IonItem,{className:"FR",button:!0,detail:!0,children:[(0,c.jsx)(s.IonIcon,{icon:o.giftSharp,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Talão de Oferta"})})]}):null,r.Ry(h.current,"copyToSale")?(0,c.jsxs)(s.IonItem,{className:"RC",button:!0,detail:!0,children:[(0,c.jsx)(s.IonIcon,{icon:o.copySharp,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Copiar para a venda"})})]}):null,r.Ry(h.current,"downloadPdf")?(0,c.jsxs)(s.IonItem,{className:"GO",button:!0,detail:!0,onClick:()=>{x("Downloading PDF..."),l.jG(e,n,p.data.number,m)},children:[(0,c.jsx)(s.IonIcon,{icon:o.documentSharp,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Download PDF"})})]}):null,r.Ry(h.current,"registerPayment")?(0,c.jsxs)(s.IonItem,{button:!0,detail:!0,children:[(0,c.jsx)(s.IonIcon,{icon:o.logoEuro,slot:"start"}),(0,c.jsx)(s.IonLabel,{children:(0,c.jsx)("h3",{children:"Registrar Pagamento"})})]}):null]})},h=m,p=e=>({details:m({apiKey:e})})},5785:(e,n,t)=>{t.d(n,{Nl:()=>i,Pq:()=>a,jG:()=>d});var s=t(7786);let o="http://vendus-pt/ws/v1.2/documents/";o="https://www.vendus.pt/ws/v1.2/documents/";const a=async(e,n=1,t,a="")=>{const i=t.join(",");let d;const l={url:`${o}`,params:{api_key:e,envelope:"1",page:n.toString(),type:i,q:a}};return await s.CapacitorHttp.get(l).then((e=>d=e.data)).catch((e=>Promise.reject(new Error(e)))),d},i=async(e,n)=>{let t;const a={url:`${o}${n}`,params:{api_key:e}};return await s.CapacitorHttp.get(a).then((e=>t=e.data)).catch((e=>Promise.reject(new Error(e)))),t},d=async(e,n,t,a)=>{const i={url:`${o}${n}.pdf`,responseType:"blob",params:{api_key:e}};await s.CapacitorHttp.get(i).then((e=>{console.log("response from download: ",e);const n=new Blob([e.data],{type:"application/pdf"}),s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=`${t}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),a()})).catch((e=>(a(),Promise.reject(new Error(e))))),a()}},5912:(e,n,t)=>{t.d(n,{Ry:()=>c,sR:()=>d,su:()=>s,zh:()=>l});const s=(e,n)=>{const t=e;return-1===t.indexOf(n)?t.push(n):t.splice(t.indexOf(n),1),t},o=[{title:"Produto",size:"5"},{title:"Preço/Uni.",end:!0},{title:"Qtd.",end:!0},{title:"Preço",end:!0}],a=[{title:"Documento",size:"6"},{title:"Faturado",end:!0},{title:"Pago",end:!0}],i=[{title:"Produto",size:"5"},{title:"Stock"},{title:"Qtd."},{title:"Preço/Uni."},{title:"Preço",end:!0}],d=e=>["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS"].includes(e)?o:["RG"].includes(e)?a:["NC"].includes(e)?i:[],l=(e,n)=>["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS"].includes(e)?n.map((e=>({title:e.title,net_unit:e.amounts.net_unit,qty:e.qty,price:e.amounts.net_total}))):["NC"].includes(e)?n.map((e=>({title:e.title,stock:e.stock_control,qty:e.qty,net_unit:e.amounts.net_unit,price:e.amounts.net_total}))):["RG"].includes(e)?n.map((e=>({title:e.title,net_unit:e.amounts.net_total,gross_total:e.amounts.gross_total}))):[],r={print:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS","NC","RG"],sendEmail:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS","NC","RG"],creditNote:["FT","FR","FS"],createTransport:["FT","FR","FS"],offerCoupon:["FT","FR","FS"],copyToSale:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS"],downloadPdf:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS","NC","RG"],registerPayment:[],edit:["GT","GA","GR","GD"],cancel:["GT","GA","GR","GD","EC","PF","OT","NC","RG"]},c=(e,n)=>!!r[`${n}`].includes(e)},2627:(e,n,t)=>{t.r(n),t.d(n,{default:()=>g});var s=t(1921),o=t(9619),a=t.n(o),i=t(1521),d=t(6021),l=t(2322);const r=({children:e,styles:n={undefined:void 0}})=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.IonButton,{id:"click-trigger",children:(0,l.jsx)(s.IonIcon,{slot:"icon-only",icon:d.settingsSharp})}),(0,l.jsx)(s.IonPopover,{trigger:"click-trigger",triggerAction:"click",size:"auto",children:(0,l.jsx)(s.IonContent,{children:e})})]});var c=t(461),m=t(5785),h=t(5912),p=t(6414),x=t(3501);const u=({headers:e,items:n})=>{const[t,a]=(0,o.useState)([]),[i,d]=(0,o.useState)([]);return(0,o.useEffect)((()=>{e.forEach((e=>{a((n=>[...n,e.size])),d((n=>[...n,e.end]))}))}),[e]),(0,l.jsxs)(s.IonGrid,{className:"no-padding",children:[(0,l.jsx)(s.IonRow,{className:"header-row",children:e.map(((e,n)=>(0,l.jsx)(s.IonCol,{size:e.size,className:"text-bold "+(e.end?"ion-text-end":""),children:e.title},n)))}),n.map(((e,n)=>{const o=Object.keys(e);return(0,l.jsx)(s.IonRow,{className:"row",children:o.map(((n,o)=>(0,l.jsx)(s.IonCol,{size:t[o],className:i[o]?"ion-text-end":"",children:e[n]},o)))},n)}))]})},j=({apiKey:e,id:n})=>{var t;const o=(0,x.useQuery)(["document",n],(()=>m.Nl(e,n)),{staleTime:6e4});return o.isLoading?(0,l.jsx)("div",{className:"ion-padding-start ion-padding-top",children:(0,l.jsx)(p.Facebook,{width:"96%"})}):o.isError?(0,l.jsx)(s.IonGrid,{className:"ion-padding",children:(0,l.jsx)(s.IonRow,{children:(0,l.jsx)(s.IonCol,{size:"12","size-sm":"5",className:"ion-no-padding ion-padding-end",children:(0,l.jsx)("div",{className:"error",children:(0,l.jsx)(s.IonText,{className:"ion-padding",children:"Something went wrong..."})})})})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.IonToolbar,{className:`${o.data.type}`,children:(0,l.jsx)(s.IonTitle,{id:"detail-doc-title",className:"ion-text-center text-white",children:o.data.number})}),(0,l.jsx)(s.IonGrid,{className:"ion-padding",children:(0,l.jsxs)(s.IonRow,{children:[(0,l.jsxs)(s.IonCol,{size:"12","size-sm":"5",className:"ion-no-padding ion-padding-end",children:[(0,l.jsx)(s.IonTitle,{className:"document__header-title",children:"Documento"}),(0,l.jsxs)("div",{className:"flex-column",children:[(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:["Data: ",o.data.date]}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:["Tipo: ",o.data.type]})]})]}),(0,l.jsxs)(s.IonCol,{size:"12",offset:"1","size-sm":"6",className:"ion-no-padding",children:[(0,l.jsx)(s.IonTitle,{className:"document__header-title",children:"Cliente"}),(0,l.jsxs)("div",{className:"flex-column",children:[(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:[o.data.client.name,"---------"!==o.data.client.fiscal_id?" - "+o.data.client.fiscal_id:""]}),(0,l.jsx)(s.IonText,{className:"ion-padding-top",children:null==(t=o.data.client)?void 0:t.address}),(0,l.jsx)(s.IonText,{className:"",children:`${o.data.client.postalcode?o.data.client.postalcode:""}${o.data.client.city?" - "+o.data.client.city:""}`})]})]})]})}),["GT","GA","GR","GD"].includes(o.data.type)?(0,l.jsxs)(s.IonGrid,{className:"ion-padding",children:[(0,l.jsxs)(s.IonRow,{children:[(0,l.jsxs)(s.IonCol,{size:"12","size-sm":"5",className:"ion-no-padding ion-padding-end",children:[(0,l.jsx)(s.IonTitle,{className:"document__header-title",children:"Local de Carga"}),(0,l.jsxs)("div",{className:"flex-column",children:[(0,l.jsx)(s.IonText,{className:"ion-padding-top",children:o.data.movement_of_goods.landpoint.address}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:[o.data.movement_of_goods.landpoint.postalcode," ","-"," ",o.data.movement_of_goods.landpoint.city]}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:[o.data.movement_of_goods.landpoint.date," ","às"," ",o.data.movement_of_goods.landpoint.time]})]})]}),(0,l.jsxs)(s.IonCol,{size:"12",offset:"1","size-sm":"6",className:"ion-no-padding",children:[(0,l.jsx)(s.IonTitle,{className:"document__header-title",children:"Local de Descarga"}),(0,l.jsxs)("div",{className:"flex-column",children:[(0,l.jsx)(s.IonText,{className:"ion-padding-top",children:o.data.movement_of_goods.loadpoint.address}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:[o.data.movement_of_goods.loadpoint.postalcode," ","-"," ",o.data.movement_of_goods.loadpoint.city]}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:[o.data.movement_of_goods.loadpoint.date," ","às"," ",o.data.movement_of_goods.loadpoint.time]})]})]})]}),(0,l.jsx)(s.IonRow,{children:(0,l.jsx)(s.IonCol,{children:(0,l.jsx)(s.IonText,{children:o.data.observations})})})]}):null,(0,l.jsx)("div",{className:"ion-padding",children:(0,l.jsx)(u,{headers:h.sR(o.data.type),items:h.zh(o.data.type,o.data.items)})}),(0,l.jsx)("div",{className:"ion-padding",children:(0,l.jsx)(s.IonGrid,{className:"no-padding",children:(0,l.jsxs)(s.IonRow,{children:[(0,l.jsx)(s.IonCol,{size:"5",className:"ion-no-padding",children:o.data.payments?(0,l.jsx)(u,{headers:[{title:"Pagamento",size:"7"},{title:"Total",end:!0}],items:o.data.payments.map((e=>({title:e.title,amount:e.amount})))}):null}),(0,l.jsx)(s.IonCol,{offset:"2",size:"5",className:"ion-no-padding",children:o.data.taxes?(0,l.jsx)(u,{headers:[{title:"Taxa",end:!0},{title:"Base",end:!0},{title:"IVA",end:!0},{title:"Total",end:!0}],items:o.data.taxes.map((e=>({rate:`${e.rate}%`,base:e.base,amount:e.amount,total:e.total})))}):null})]})})}),(0,l.jsx)("div",{className:"ion-padding",children:(0,l.jsx)(s.IonGrid,{className:"no-padding",children:(0,l.jsx)(s.IonRow,{children:(0,l.jsx)(s.IonCol,{offset:"7",size:"5",className:"ion-no-padding",children:(0,l.jsx)(u,{headers:[{title:"Total"},{title:o.data.amount_gross,end:!0}],items:[]})})})})}),["DC","EC","PF","OT","FT","FR","FS","RG"].includes(o.data.type)?(0,l.jsx)(s.IonGrid,{className:"ion-padding",children:(0,l.jsx)(s.IonRow,{children:(0,l.jsxs)(s.IonCol,{size:"12","size-sm":"6",className:"ion-no-padding ion-padding-end",children:[(0,l.jsx)(s.IonTitle,{className:"document__header-title",children:"Informações do Utilizador"}),(0,l.jsxs)("div",{className:"flex-column",children:[(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:["Nome: ",o.data.status.user_id]}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:["Loja: ",o.data.store_id]}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:["Caixa: ",o.data.register_id]}),(0,l.jsxs)(s.IonText,{className:"ion-padding-top",children:["Data: ",o.data.system_time]})]})]})})}):null]})};var I=t(9297);const g=({apiKey:e})=>{const{id:n}=(0,i.useParams)(),t=(0,I.useDocumentDetailsOptions)(e),o=(0,c.useHistory)();return(0,l.jsxs)(s.IonPage,{children:[(0,l.jsx)(s.IonHeader,{children:(0,l.jsxs)(s.IonToolbar,{children:[(0,l.jsxs)(s.IonButtons,{slot:"start",children:[(0,l.jsx)(s.IonMenuButton,{}),(0,l.jsx)(s.IonButton,{onClick:()=>o.push("/documents"),children:(0,l.jsx)(s.IonIcon,{icon:d.arrowBackSharp,slot:"start"})})]}),(0,l.jsx)(s.IonButtons,{slot:"end",className:"ion-hide-lg-up",children:(0,l.jsx)(a().Suspense,{children:(0,l.jsx)(r,{children:t.details})})})]})}),(0,l.jsx)(s.IonContent,{fullscreen:!0,children:(0,l.jsx)(s.IonGrid,{className:"h--100",children:(0,l.jsxs)(s.IonRow,{className:"h--100",children:[(0,l.jsx)(s.IonCol,{size:"12","size-lg":"9",children:(0,l.jsx)(j,{apiKey:e,id:n})}),(0,l.jsx)(s.IonCol,{className:"side-menu ion-hide-lg-down",size:"12","size-sm":"3",children:t.details})]})})})]})}},1837:(e,n,t)=>{var s=t(9619),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,d=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function r(e,n,t){var s,a={},r=null,c=null;for(s in void 0!==t&&(r=""+t),void 0!==n.key&&(r=""+n.key),void 0!==n.ref&&(c=n.ref),n)i.call(n,s)&&!l.hasOwnProperty(s)&&(a[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps)void 0===a[s]&&(a[s]=n[s]);return{$$typeof:o,type:e,key:r,ref:c,props:a,_owner:d.current}}n.Fragment=a,n.jsx=r,n.jsxs=r},2322:(e,n,t)=>{e.exports=t(1837)}}]);