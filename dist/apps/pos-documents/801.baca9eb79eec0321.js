/*! For license information please see 801.baca9eb79eec0321.js.LICENSE.txt */
(self.webpackChunkpos_documents=self.webpackChunkpos_documents||[]).push([[801,982],{2982:(e,s,t)=>{t.r(s),t.d(s,{default:()=>d,useFilter:()=>c});var n=t(1921),o=t(9619),r=t(3501),i=t(5912),l=t(2322);const a=({typesFiltered:e,setTypesFiltered:s})=>{const t=(0,r.useIsFetching)(),[a,c]=(0,o.useState)(!0),d=(0,o.useRef)(e);return(0,o.useEffect)((()=>()=>{s(d.current)}),[]),(0,o.useEffect)((()=>{s(a?d.current:[])}),[a,s]),(0,l.jsxs)("div",{className:"ion-padding-top",children:[(0,l.jsx)(n.IonTitle,{className:"ion-no-padding ion-padding-bottom",children:"Document Types"}),(0,l.jsxs)(n.IonList,{lines:"full",children:[(0,l.jsxs)(n.IonItem,{disabled:!!t,children:[(0,l.jsx)(n.IonCheckbox,{checked:a,onClick:()=>{c(!a)},slot:"start"}),(0,l.jsx)(n.IonBadge,{className:"DC",children:"T"}),(0,l.jsx)(n.IonLabel,{className:"ion-padding-start",children:"Todos"})]},"all"),u.map(((o,r)=>(0,l.jsxs)(n.IonItem,{disabled:!!t,children:[(0,l.jsx)(n.IonCheckbox,{onClick:()=>{return t=o.symbol,void setTimeout((()=>{const n=i.su(e,t);s(n)}),0);var t},value:o.symbol,checked:e.includes(o.symbol),slot:"start"}),(0,l.jsx)(n.IonBadge,{className:o.class,children:o.symbol}),(0,l.jsx)(n.IonLabel,{className:"ion-padding-start",children:o.title})]},r)))]})]})},c=(e,s)=>({filter:a({typesFiltered:e,setTypesFiltered:s})}),d=a,u=[{title:"Consulta de Mesa",symbol:"DC",class:"DC"},{title:"Encomenda",symbol:"EC",class:"EC"},{title:"Fatura",symbol:"FT",class:"FT"},{title:"Fatura Pró-Forma",symbol:"PF",class:"PF"},{title:"Fatura Recibo",symbol:"FR",class:"FR"},{title:"Fatura Simplificada",symbol:"FS",class:"FS"},{title:"Guia de Ativos Próprios",symbol:"GA",class:"GA"},{title:"Guia de Devolução",symbol:"GD",class:"GD"},{title:"Nota de Crédito",symbol:"NC",class:"NC"},{title:"Orçamento",symbol:"OT",class:"OT"},{title:"Guia de Transporte",symbol:"GT",class:"GT"},{title:"Guia de Remessa",symbol:"GR",class:"GR"},{title:"Recibo",symbol:"RG",class:"RG"}]},5785:(e,s,t)=>{t.d(s,{Nl:()=>i,Pq:()=>r,jG:()=>l});var n=t(7786);let o="http://vendus-pt/ws/v1.2/documents/";o="https://www.vendus.pt/ws/v1.2/documents/";const r=async(e,s=1,t,r="")=>{const i=t.join(",");let l;const a={url:`${o}`,params:{api_key:e,envelope:"1",page:s.toString(),type:i,q:r}};return await n.CapacitorHttp.get(a).then((e=>l=e.data)).catch((e=>Promise.reject(new Error(e)))),l},i=async(e,s)=>{let t;const r={url:`${o}${s}`,params:{api_key:e}};return await n.CapacitorHttp.get(r).then((e=>t=e.data)).catch((e=>Promise.reject(new Error(e)))),t},l=async(e,s,t,r)=>{const i={url:`${o}${s}.pdf`,responseType:"blob",params:{api_key:e}};await n.CapacitorHttp.get(i).then((e=>{console.log("response from download: ",e);const s=new Blob([e.data],{type:"application/pdf"}),n=URL.createObjectURL(s),o=document.createElement("a");o.href=n,o.download=`${t}.pdf`,document.body.appendChild(o),o.click(),document.body.removeChild(o),r()})).catch((e=>(r(),Promise.reject(new Error(e))))),r()}},5912:(e,s,t)=>{t.d(s,{Ry:()=>d,sR:()=>l,su:()=>n,zh:()=>a});const n=(e,s)=>{const t=e;return-1===t.indexOf(s)?t.push(s):t.splice(t.indexOf(s),1),t},o=[{title:"Produto",size:"5"},{title:"Preço/Uni.",end:!0},{title:"Qtd.",end:!0},{title:"Preço",end:!0}],r=[{title:"Documento",size:"6"},{title:"Faturado",end:!0},{title:"Pago",end:!0}],i=[{title:"Produto",size:"5"},{title:"Stock"},{title:"Qtd."},{title:"Preço/Uni."},{title:"Preço",end:!0}],l=e=>["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS"].includes(e)?o:["RG"].includes(e)?r:["NC"].includes(e)?i:[],a=(e,s)=>["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS"].includes(e)?s.map((e=>({title:e.title,net_unit:e.amounts.net_unit,qty:e.qty,price:e.amounts.net_total}))):["NC"].includes(e)?s.map((e=>({title:e.title,stock:e.stock_control,qty:e.qty,net_unit:e.amounts.net_unit,price:e.amounts.net_total}))):["RG"].includes(e)?s.map((e=>({title:e.title,net_unit:e.amounts.net_total,gross_total:e.amounts.gross_total}))):[],c={print:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS","NC","RG"],sendEmail:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS","NC","RG"],creditNote:["FT","FR","FS"],createTransport:["FT","FR","FS"],offerCoupon:["FT","FR","FS"],copyToSale:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS"],downloadPdf:["FT","DC","FR","GT","GA","GR","GD","EC","PF","OT","FS","NC","RG"],registerPayment:[],edit:["GT","GA","GR","GD"],cancel:["GT","GA","GR","GD","EC","PF","OT","NC","RG"]},d=(e,s)=>!!c[`${s}`].includes(e)},4801:(e,s,t)=>{t.r(s),t.d(s,{default:()=>j});var n=t(1921),o=t(9619),r=t(6021),i=t(5785),l=t(3501),a=t(6414),c=t.n(a),d=t(2322);const u=()=>(0,d.jsxs)(c(),{speed:2,width:200,height:62,viewBox:"0 0 200 62",backgroundColor:"#f3f3f3",foregroundColor:"#ecebeb",children:[(0,d.jsx)("rect",{x:"72",y:"16",rx:"3",ry:"3",width:"150",height:"15"}),(0,d.jsx)("rect",{x:"72",y:"38",rx:"3",ry:"3",width:"74",height:"13"}),(0,d.jsx)("rect",{x:"0",y:"15",rx:"3",ry:"3",width:"40",height:"33"})]}),m=({item:e,isFetching:s,isPreviousData:t})=>(0,d.jsx)(n.IonItem,{routerLink:`/documents/${e.id}`,button:!0,detail:!0,children:s&&t?(0,d.jsx)(u,{}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.IonBadge,{slot:"start",className:e.type,children:e.type?e.type:"ZZ"}),(0,d.jsxs)(n.IonLabel,{children:[(0,d.jsx)("h2",{children:e.number?e.number:"NO NUMBER"}),(0,d.jsx)("p",{children:e.date?e.date:""})]}),(0,d.jsx)(n.IonLabel,{slot:"end",color:"medium",children:e.amount_gross?e.amount_gross:"ZZ"})]})}),h=({placeholder:e,setQueryString:s,disabled:t,focusSearchBar:r})=>{const i=(0,o.useRef)(null);return(0,o.useEffect)((()=>{r&&setTimeout((()=>{var e;return null==(e=i.current)?void 0:e.setFocus()}),10)}),[r,t]),(0,d.jsx)(n.IonSearchbar,{mode:"ios",placeholder:e,debounce:1e3,onIonChange:e=>(e=>{let t="";const n=e.target;n&&(t=n.value.toLowerCase()),s(t)})(e),onIonClear:e=>s(""),disabled:t,ref:i,className:"search-bar ion-no-padding",inputmode:"search",enterkeyhint:"enter"})},p=({setQueryString:e})=>{const s=(0,l.useIsFetching)(),[t,r]=(0,o.useState)(!1);return(0,n.useIonViewWillLeave)((()=>{r(!1)})),(0,d.jsx)(n.IonHeader,{children:(0,d.jsxs)(n.IonToolbar,{children:[(0,d.jsxs)(n.IonButtons,{slot:"start",className:"header-buttons",children:[(0,d.jsx)(n.IonMenuButton,{}),(0,d.jsxs)(n.IonCol,{className:"title-spinner",children:[(0,d.jsx)(n.IonTitle,{className:"title ion-no-padding ion-padding-end",children:"Documents"}),s?(0,d.jsx)(n.IonSpinner,{className:"spinner",name:"dots"}):null]})]}),(0,d.jsx)(h,{placeholder:"Busca...",setQueryString:s=>{e(s)},disabled:!!s,focusSearchBar:t})]})})};var x=t(2982);const j=({typesFiltered:e,setTypesFiltered:s,apiKey:t})=>{const[a,c]=(0,o.useState)(1),u=(0,o.useRef)(0),h=(0,o.useRef)(0),[j,y]=(0,o.useState)(""),I=(0,l.useQuery)(["documents",a,j],(()=>i.Pq(t,a,e,j)),{keepPreviousData:!0,staleTime:6e4}),F=(0,x.useFilter)(e,s),f=(0,o.useRef)(null);var g,C;return(0,o.useEffect)((()=>{I.refetch(),c(1)}),[e,j]),(0,n.useIonViewWillLeave)((()=>{c(1),y("")})),I.isSuccess&&I.data.headers.length>0&&(u.current=parseFloat(null==(g=I.data)?void 0:g.headers[0].match(/\d+/g)),h.current=parseFloat(null==(C=I.data)?void 0:C.headers[1].match(/\d+/g))),I.isError?(0,d.jsx)("p",{children:"Something went wrong..."}):(0,d.jsxs)(n.IonPage,{children:[(0,d.jsx)(p,{setQueryString:e=>{y(e)}}),(0,d.jsx)(n.IonContent,{fullscreen:!0,children:(0,d.jsx)(n.IonGrid,{className:"h--100",children:(0,d.jsxs)(n.IonRow,{className:"h--100",children:[(0,d.jsx)(n.IonCol,{size:"12","size-sm":"3",className:"side-menu ion-hide-lg-down",children:F.filter}),(0,d.jsx)(n.IonCol,{size:"12","size-lg":"9",children:I.isSuccess?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.IonButton,{size:"small",id:"open-modal",expand:"full",className:"ion-hide-lg-up",children:"Filters"}),(0,d.jsxs)(n.IonModal,{ref:f,trigger:"open-modal",children:[(0,d.jsx)(n.IonHeader,{children:(0,d.jsxs)(n.IonToolbar,{children:[(0,d.jsx)(n.IonButtons,{slot:"start",children:(0,d.jsx)(n.IonButton,{onClick:()=>{var e;return null==(e=f.current)?void 0:e.dismiss()},children:"Cancel"})}),(0,d.jsx)(n.IonButtons,{slot:"end",children:(0,d.jsx)(n.IonButton,{strong:!0,onClick:()=>{var e;return null==(e=f.current)?void 0:e.dismiss()},children:"Confirm"})})]})}),(0,d.jsx)(n.IonContent,{className:"ion-padding",children:F.filter})]}),(0,d.jsx)(n.IonList,{lines:"full",children:I.data.response.length>0?I.data.response.map((e=>(0,d.jsx)(m,{item:e,isFetching:I.isFetching,isPreviousData:I.isPreviousData},e.id))):(0,d.jsx)(n.IonRow,{className:"ion-align-items-center ion-justify-content-center",children:(0,d.jsxs)(n.IonCol,{className:"ion-text-center ion-margin-top",size:"auto",children:[(0,d.jsx)(n.IonRow,{className:"ion-justify-content-center",children:(0,d.jsx)(n.IonCol,{size:"8",children:(0,d.jsx)(n.IonRow,{className:"ion-justify-content-center",children:(0,d.jsx)(n.IonImg,{className:"",src:"/assets/img/icon-empty.svg"})})})}),(0,d.jsx)(n.IonTitle,{className:"ion-margin-top ion-margin-bottom",children:"Não foi encontrado Dados."}),(0,d.jsx)(n.IonText,{class:"ion-margin-top",children:"Não existem dados disponíveis nesta busca. Ajuste o filtro, se necessário."})]})})})]}):null})]})})}),(0,d.jsx)(n.IonFooter,{children:(0,d.jsx)(n.IonToolbar,{children:(0,d.jsx)(n.IonGrid,{children:(0,d.jsx)(n.IonRow,{children:I.isSuccess?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.IonCol,{className:"borders-x",size:"3","size-sm":"auto","offset-sm":"3",children:(0,d.jsxs)(n.IonButtons,{className:"ion-justify-content-center",children:[(0,d.jsx)(n.IonButton,{onClick:()=>{c((e=>Math.max(e-1,0)))},disabled:1===a,children:(0,d.jsx)(n.IonIcon,{slot:"icon-only",icon:r.chevronBack})}),(0,d.jsx)(n.IonButton,{onClick:()=>{I.isPreviousData||c((e=>e+1))},disabled:a===h.current,children:(0,d.jsx)(n.IonIcon,{slot:"icon-only",icon:r.chevronForward})})]})}),(0,d.jsx)(n.IonCol,{className:"borders-x",children:(0,d.jsx)(n.IonTitle,{children:`${a}/${h.current}`})}),(0,d.jsx)(n.IonCol,{className:"borders-x",size:"4","size-sm":"auto",children:(0,d.jsx)(n.IonTitle,{children:`${u.current} Documents`})})]}):null})})})})]})}},1837:(e,s,t)=>{var n=t(9619),o=Symbol.for("react.element"),r=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(e,s,t){var n,r={},c=null,d=null;for(n in void 0!==t&&(c=""+t),void 0!==s.key&&(c=""+s.key),void 0!==s.ref&&(d=s.ref),s)i.call(s,n)&&!a.hasOwnProperty(n)&&(r[n]=s[n]);if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===r[n]&&(r[n]=s[n]);return{$$typeof:o,type:e,key:c,ref:d,props:r,_owner:l.current}}s.Fragment=r,s.jsx=c,s.jsxs=c},2322:(e,s,t)=>{e.exports=t(1837)}}]);